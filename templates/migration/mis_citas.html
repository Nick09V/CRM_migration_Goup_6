{% extends "base.html" %}

{% block title %}Mis Citas | CRM Migration{% endblock %}

{% block content %}
{% include "partials/navbar.html" %}

<div class="flex h-[calc(100vh-65px)] overflow-hidden">
    {% include "partials/sidebar.html" %}

    <main class="flex-1 overflow-y-auto p-8 bg-slate-50 dark:bg-background-dark/50">
        <div class="max-w-5xl mx-auto space-y-6">

            <div class="flex justify-between items-end">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Agenda de Citas</h1>
                    <p class="text-sm text-slate-500">Cronograma de reuniones y asignaciones.</p>
                </div>
                <div class="bg-white dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800 flex gap-1">
                    <button class="px-3 py-1.5 bg-primary text-white text-xs font-bold rounded shadow-sm">Próximas</button>
                    <button class="px-3 py-1.5 text-slate-500 hover:bg-slate-50 text-xs font-bold rounded transition-colors">Historial</button>
                </div>
            </div>

            <div class="space-y-4">
                {% for cita in citas %}
                <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 shadow-sm hover:shadow-md transition-all group flex flex-col md:flex-row gap-6 items-center">
                    
                    <div class="flex flex-col items-center justify-center min-w-[80px] border-r border-slate-100 dark:border-slate-800 pr-6">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">{{ cita.inicio|date:"M" }}</span>
                        <span class="text-3xl font-bold text-slate-800 dark:text-white">{{ cita.inicio|date:"d" }}</span>
                        <span class="text-xs font-bold text-slate-500">{{ cita.inicio|date:"D"|title }}</span>
                    </div>

                    <div class="flex-1 w-full text-center md:text-left">
                        <div class="flex flex-col md:flex-row md:items-center gap-2 mb-1">
                            <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded text-[10px] font-bold uppercase 
                                {% if cita.estado == 'pendiente' %}bg-amber-100 text-amber-700
                                {% elif cita.estado == 'exitosa' %}bg-emerald-100 text-emerald-700
                                {% else %}bg-slate-100 text-slate-600{% endif %}">
                                <span class="size-1.5 rounded-full {% if cita.estado == 'pendiente' %}bg-amber-500 animate-pulse{% elif cita.estado == 'exitosa' %}bg-emerald-500{% else %}bg-slate-400{% endif %}"></span>
                                {{ cita.get_estado_display }}
                            </span>
                            <span class="text-xs text-slate-400 font-mono flex items-center justify-center md:justify-start gap-1">
                                <span class="material-symbols-outlined text-[14px]">schedule</span>
                                {{ cita.inicio|date:"H:i A" }}
                            </span>
                        </div>
                        
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-1">
                            {{ cita.solicitante.nombre }}
                        </h3>
                        
                        <div class="flex items-center justify-center md:justify-start gap-4 text-xs text-slate-500">
                            <span class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-[14px]">badge</span>
                                {{ cita.solicitante.cedula }}
                            </span>
                            <span class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-[14px]">work</span>
                                Visa {{ cita.solicitante.tipo_visa|default:"General"|title }}
                            </span>
                        </div>
                    </div>

                    <div>
                        <a href="{% url 'cita_detalle' cita.id %}" 
                           class="whitespace-nowrap px-5 py-2.5 bg-white border border-slate-200 text-slate-600 hover:border-primary hover:text-primary hover:bg-primary/5 text-sm font-bold rounded-lg transition-colors flex items-center gap-2 group-hover:border-primary group-hover:text-primary">
                            Gestionar
                            <span class="material-symbols-outlined text-lg">arrow_forward</span>
                        </a>
                    </div>

                </div>
                {% empty %}
                <div class="bg-white dark:bg-slate-900 rounded-xl border-2 border-dashed border-slate-200 dark:border-slate-800 p-12 text-center">
                    <div class="size-16 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300">
                        <span class="material-symbols-outlined text-3xl">event_busy</span>
                    </div>
                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300">No hay citas programadas</h3>
                    <p class="text-sm text-slate-500 mt-1">Tu agenda está libre por el momento.</p>
                </div>
                {% endfor %}
            </div>

        </div>
    </main>
</div>

{% endblock %}